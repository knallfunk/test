package com.wisedu.cloud.smp.dal.spc.dao.impl;

import com.wisedu.cloud.smp.common.exception.DaoException;
import com.wisedu.cloud.smp.dal.spc.dao.SchoolDao;
import com.wisedu.cloud.smp.dal.spc.mapper.SchoolExtendMapper;
import com.wisedu.cloud.smp.dal.spc.mapper.SchoolMapper;
import com.wisedu.cloud.smp.dal.spc.model.School;
import com.wisedu.cloud.smp.dal.spc.model.SchoolExample;
import com.wisedu.cloud.smp.dal.spc.model.extend.Page;
import com.wisedu.cloud.smp.dal.spc.model.extend.SchoolWithLicense;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Repository;

import java.util.Date;
import java.util.List;

/**
 * Created by huangxuecan on 2016/4/8.
 */
@Repository("schoolDao")
public class SchoolDaoImpl implements SchoolDao {

    @Autowired
    private SchoolMapper schoolMapper;

    @Autowired
    private SchoolExtendMapper schoolExtendMapper;

    @Override
    public School getSchoolById(String schoolId) throws DaoException {
        try {
            return schoolMapper.selectByPrimaryKey(schoolId);
        } catch (Exception e) {
            throw new DaoException("",e);
        }
    }

    @Override
    public void insertSchool(School school) throws DaoException {
        try {
            Date currentTime = new Date();
            school.setCreateTime(currentTime);
            school.setUpdateTime(currentTime);
            school.setStatus((short) 0);
            schoolMapper.insertSelective(school);
        } catch (Exception e) {
            throw new DaoException("",e);
        }
    }

    @Override
    public List<SchoolWithLicense> getSchools(String condition,Page page) throws DaoException{
        try {
            return schoolExtendMapper.getSchoolByCondition(condition,page);
        }catch (Exception e){
            throw new DaoException("",e);
        }
    }

    @Override
    public  int getSchoolNum(SchoolExample schoolExample) throws DaoException{
        try {
            return schoolMapper.countByExample(schoolExample);
        }catch (Exception e){
            throw new DaoException("",e);
        }
    }
}
